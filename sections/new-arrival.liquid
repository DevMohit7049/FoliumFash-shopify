{{ 'new-arrival.css' | asset_url | stylesheet_tag }}

<section class="new-arrival-section" id="section-{{ section.id }}">
  <div class="new-arrival-header">
    <h2 class="section-title">{{ section.settings.arrival_heading }}</h2>
    <div class="collection-tabs">
      <button class="tab-btn active" data-handle="womens">Women's</button>
      <button class="tab-btn" data-handle="mens">Men's</button>
      <button class="tab-btn" data-handle="accessories">Accessories</button>
    </div>
  </div>
  <div id="collection-grid-{{ section.id }}" class="collection-grid"></div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
  const sectionEl = document.getElementById("section-{{ section.id }}");
  const grid = sectionEl.querySelector(`#collection-grid-{{ section.id }}`);
  const tabs = sectionEl.querySelectorAll(".tab-btn");
  let isLoading = false;

  const showShimmer = () => {
    const shimmerHTML = Array(6).fill(`
      <div class="product-card shimmer-card">
        <div class="shimmer-img"></div>
        <div class="shimmer-line short"></div>
        <div class="shimmer-line"></div>
      </div>
    `).join('');
    grid.innerHTML = shimmerHTML;
    grid.classList.add("loading");
  };

  const fade = (el, type, duration = 300) => {
    el.style.transition = `opacity ${duration}ms ease`;
    el.style.opacity = type === "in" ? 1 : 0;
  };

  const loadCollection = async (handle) => {
    if (isLoading) return;
    isLoading = true;

    fade(grid, "out");
    showShimmer();
    fade(grid, "in");

    try {
      const res = await fetch(`/collections/${handle}?view=ajax-grid`);
      const html = await res.text();

      setTimeout(() => {
        fade(grid, "out");
        setTimeout(() => {
          grid.innerHTML = html;
          grid.classList.remove("loading");
          fade(grid, "in");
          isLoading = false;
        }, 200);
      }, 300);

    } catch (err) {
      grid.innerHTML = "<p>Something went wrong.</p>";
      fade(grid, "in");
      isLoading = false;
    }
  };

  tabs.forEach(tab => {
    tab.addEventListener("click", function () {
      if (this.classList.contains("active")) return;

      tabs.forEach(t => t.classList.remove("active"));
      this.classList.add("active");

      loadCollection(this.dataset.handle);
    });
  });

  // Default load
  loadCollection("womens");
});
</script>


{% schema %}
{
  "name": "New Arrival Tabs",
  "settings": [
  {
    "type": "text",
    "label": "heading", 
    "id": "arrival_heading",
    "default":"New Arrival"
  }
],
  "presets": [
    { "name": "New Arrival Tabs" }
  ]
}
{% endschema %}
